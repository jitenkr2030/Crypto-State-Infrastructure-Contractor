# CSIC 平台配置

```yaml
# Crypto State Infrastructure Contractor - 主配置文件
# 版本: 1.0.0
# 用途: 政府级加密货币监管基础设施

app:
  name: "CSIC Platform"
  version: "1.0.0"
  environment: "production"  # development, staging, production
  deployment_type: "on-premises"  # on-premises, private-cloud, air-gapped

# 核心服务配置
services:
  api_gateway:
    host: "0.0.0.0"
    http_port: 8080
    grpc_port: 50051
    max_request_timeout: 30s
    max_request_size: 10MB
    rate_limit:
      requests_per_minute: 1000
      burst: 100

  control_layer:
    enforcement_enabled: true
    policy_cache_ttl: 5m
    intervention_timeout: 10s

  audit_log:
    write_batch_size: 100
    flush_interval: 5s
    retention_days: 2555  # 7年合规要求
    compression: true

  health_monitor:
    check_interval: 30s
    timeout: 10s
    retry_count: 3

# 数据库配置 (PostgreSQL - 主数据库)
database:
  host: "10.0.0.10"
  port: 5432
  name: "csic_core"
  user: "csic_admin"
  password_file: "/etc/csic/db_password"
  ssl_mode: "require"
  max_open_conns: 100
  max_idle_conns: 25
  conn_max_lifetime: 30m
  pool_mode: "transaction"

# 时序数据库配置 (TimescaleDB - 遥测数据)
timescaledb:
  host: "10.0.0.11"
  port: 5432
  name: "csic_telemetry"
  user: "csic_telemetry"
  password_file: "/etc/csic/tsdb_password"
  retention: "90d"
  compression: true

# 缓存配置 (Redis)
redis:
  host: "10.0.0.12"
  port: 6379
  password_file: "/etc/csic/redis_password"
  db: 0
  pool_size: 50
  max_retries: 3
  read_timeout: 5s
  write_timeout: 5s

# 搜索引擎配置 (OpenSearch)
opensearch:
  hosts:
    - "https://10.0.0.20:9200"
  index_prefix: "csic"
  retention_days: 365
  ssl_enabled: true
  auth:
    username_file: "/etc/csic/opensearch_user"

# WORM存储配置 (只写一次存储 - 审计日志)
worm_storage:
  primary_path: "/data/worm/audit"
  replica_path: "/data/worm/replica"
  retention_days: 2555
  encryption: "AES-256-GCM"
  write_once: true

# 区块链节点配置 (自托管节点)
blockchain:
  bitcoin:
    rpc_url: "http://10.0.1.10:8332"
    rpc_user_file: "/etc/csic/btc_rpc_user"
    rpc_password_file: "/etc/csic/btc_rpc_password"
    zmq_url: "tcp://10.0.1.10:28332"
    wallet_name: "csic-custody"
    sync_interval: 30s

  ethereum:
    rpc_url: "http://10.0.1.20:8545"
    rpc_user_file: "/etc/csic/eth_rpc_user"
    rpc_password_file: "/etc/csic/eth_rpc_password"
    ws_url: "ws://10.0.1.20:8546"
    sync_interval: 5s
    chain_id: 1

# Kafka配置 (事件流)
kafka:
  brokers:
    - "10.0.0.30:9092"
    - "10.0.0.31:9092"
    - "10.0.0.32:9092"
  consumer_group: "csic-processors"
  topics:
    transactions: "csic.transactions"
    alerts: "csic.alerts"
    audit_logs: "csic.audit"
    exchange_data: "csic.exchange"
    mining_metrics: "csic.mining"
  security:
    sasl_mechanism: "SCRAM-SHA-512"
    tls_enabled: true

# HSM配置 (硬件安全模块)
hsm:
  provider: "pkcs11"
  library_path: "/usr/lib/softhsm/libsofthsm2.so"
  slot: 0
  pin_file: "/etc/csic/hsm_pin"
  key_label: "csic-master-key"
  key_type: "RSA-4096"
  auto_rotate: true
  rotation_period: 365d

# TLS证书配置
tls:
  cert_file: "/etc/csic/tls/server.crt"
  key_file: "/etc/csic/tls/server.key"
  ca_file: "/etc/csic/tls/ca.crt"
  min_version: "TLSv1.3"
  cipher_suites:
    - "TLS_AES_256_GCM_SHA384"
    - "TLS_CHACHA20_POLY1305_SHA256"

# 安全配置
security:
  jwt:
    secret_file: "/etc/csic/jwt_secret"
    expiry_hours: 8
    refresh_expiry_hours: 72
    algorithm: "HS512"

  password_policy:
    min_length: 16
    require_uppercase: true
    require_lowercase: true
    require_numbers: true
    require_special_chars: true
    password_history: 12
    max_age_days: 90

  mfa:
    enabled: true
    issuer: "CSIC Platform"
    window: 1
    backup_codes: 10

  session:
    idle_timeout: 30m
    absolute_timeout: 8h
    concurrent_limit: 1

# 监管规则配置
regulatory:
  compliance_framework: "BASEL-III"
  risk_weights:
    exchange: 0.2
    wallet: 0.15
    mining: 0.1
    transaction: 0.25
  thresholds:
    large_transaction: 10000  # USD
    suspicious_pattern: 3
    volume_anomaly: 2.0  # 2x标准差
  reporting:
    daily_deadline: "06:00 UTC"
    monthly_deadline: "05:00 UTC"
    quarterly_deadline: "04:00 UTC"

# 挖矿控制配置
mining:
  hash_rate_unit: "PH/s"
  power_unit: "MW"
  monitoring_interval: 60s
  remote_shutdown_enabled: true
  energy_threshold_warning: 0.85
  energy_threshold_critical: 0.95

# 交易所监控配置
exchange:
  data_feed_interval: 1s
  manipulation_detection:
    wash_trading_threshold: 0.05
    spoofing_detection: true
    layering_detection: true
  health_check_interval: 30s
  auto_suspend_threshold: 0.8

# 日志配置
logging:
  level: "INFO"  # DEBUG, INFO, WARN, ERROR
  format: "json"
  output:
    - type: "file"
      path: "/var/log/csic/app.log"
      max_size: "100MB"
      max_backups: 10
    - type: "syslog"
      host: "10.0.0.40:514"
      protocol: "tcp"
  audit_log_enabled: true

# 监控配置
monitoring:
  metrics_enabled: true
  tracing_enabled: true
  health_check_interval: 30s
  alert_threshold_cpu: 80
  alert_threshold_memory: 85
  alert_threshold_disk: 90

# 灾难恢复配置
disaster_recovery:
  backup_interval: 1h
  retention_days: 30
  replication_target: "backup-site"
  rpo: 1h
  rto: 4h
  failover_mode: "manual"  # manual, automatic

# 白名单/黑名单配置
blacklist:
  addresses:
    bitcoin: []
    ethereum: []
  entities: []
  jurisdictions: []
  exchanges: []

whitelist:
  authorized_exchanges: []
  authorized_wallets: []
  authorized_miners: []
```

## 配置文件说明

| 配置项 | 说明 | 安全等级 |
|--------|------|----------|
| 密码文件路径 | 所有敏感凭据存储在受保护的文件中 | 高 |
| HSM配置 | 硬件安全模块用于密钥管理 | 关键 |
| TLS配置 | 强制使用TLS 1.3 | 高 |
| JWT配置 | 短期令牌+刷新令牌机制 | 高 |
| WORM存储 | 审计日志只写一次存储 | 关键 |
| 双因素认证 | 所有用户强制MFA | 高 |

## 部署说明

1. 所有凭据必须通过安全渠道获取
2. HSM必须在物理安全区域内
3. WORM存储需要独立的存储介质
4. 所有网络通信必须加密
5. 定期进行安全审计
